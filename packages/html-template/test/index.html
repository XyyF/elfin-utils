<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta name="apple-mobile-web-app-capable" content="no" />
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>kf-pixui-preview</title>
    </link>
    <style>
      div {
        box-sizing: border-box;
      }

      #colorRange {
        margin-bottom: 18px;
      }

      .color_item {
        position: relative;
        display: inline-block;
        margin-bottom: 18px;
      }

      .color_label {
        position: absolute;
        top: 20px;
        padding: 0;
        line-height: 20px;
        height: 20px;
        margin-top: -10px;
        font-size: 15px;
        width: 140px;
        text-align: right;
      }

      .color_margin150 {
        margin-left: 150px;
      }

      .color_cell {
        width: 200px;
        height: 40px;
        line-height: 40px;
        display: table;
      }

      .color_cell_r {
        border-width: 10px;
        border-style: solid;
      }

      .color_value {
        font-size: 12px;
      }

      .img_item {
        height: 176px;
        margin-right: 20px;
        margin-bottom: 20px;
        display: inline-block;
        margin-bottom: 18px;
      }

      .img_wrap {
        height: 150px;
        background-color: rgba(0, 0, 0, .03);
      }

      .img_wrap img {
        max-height: 150px;
        transform: translate(-50%, -50%);
        position: relative;
        top: 50%;
        left: 50%;
      }
    </style>
  </head>
  <body>
    <div>
      <div>
        <h2>图片区间:</h2>
        <div id="imgRange"></div>
      </div>
    </div>
    <script id="imgRange_tpl" type="text/html">
      <% if (imgRange.length > 0) { %>
        <% for (i = 0, len = imgRange.length; i < len; i++) { %>
          <div class="img_item">
            <div class="img_wrap">
              <img src="<%= imgRange[i].url %>" />
            </div>
            <div class="img_name">
              <%= imgRange[i].name %>
            </div>
          </div>
        <% } %>
      <% } %>
    </script>
    <script src="../src/index.js"></script>
    <script>
      /**
       * 发送ajax请求
       * @param {string} method 方法名，GET、POST
       * @param {obejct} options
       * @param {string} options.url 请求url
       * @param {string|object} options.data 携带数据，GET请求为字符串，POST请求为对象
       * @returns 
       */
      function ajaxApi(method, options) {
        // 如果是GET请求，将data中的数据添加到url中；
        if (method === 'GET' && options.data) {
          options.url += `?${options.data}`;
        }

        // 如果不是自定义的请求，那么带上默认的域名
        if (options.url.indexOf('http') !== 0) {
          options.url = window.location.origin + options.url;
        }

        return new Promise((resolve, reject) => {
          let xhr = new XMLHttpRequest();

          // 设置请求监听回调
          xhr.onerror = function () {
            reject(new Error('request.error'));
          };
          xhr.ontimeout = function () {
            reject(new Error('request.error.timeout'));
          };
          xhr.onload = function () {
            resolve(xhr.response);
          };
          xhr.onloadend = function () {
            xhr.onerror = null;
            xhr.ontimeout = null;
            xhr.onload = null;
            xhr.onloadend = null;
          };
          // 是否可以跨站点访问
          // xhr.withCredentials = true;
          // 超时时间
          xhr.timeout = 5000;
          // 设置请求头
          xhr.open(method, options.url);
          xhr.setRequestHeader('Accept', 'application/json');
          xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded;charset=utf-8');

          // 发送请求
          if (method === 'GET') {
            xhr.send();
          } else {
            xhr.send(JSON.stringify(options.data));
          }
        });
      }
    </script>
    <script>
      // 颜色区间
      function initColorRange() {
        let res = '.a{color:#adaada}';
        var regexp = /\.([a-z_0-9]+){[a-zA-Z0-9-]+:([#a-zA-Z0-9-]+);?}/g;
        var colorRange = [], result = null;
        while (result = regexp.exec(res)) {
          colorRange.push({
            name: result[1],
            color: result[2],
            type: result[1][result[1].length - 1],
          });
        }
        console.log(111, elfinTpl(document.querySelector('#imgRange_tpl').innerHTML, { imgRange: [{url: '12', name: '123'}] }))

        document.querySelector('#imgRange').innerHTML = elfinTpl(document.querySelector('#imgRange_tpl').innerHTML, { imgRange: [{url: '12', name: '123'}] });
      }
      initColorRange();
    </script>
  </body>
</html>